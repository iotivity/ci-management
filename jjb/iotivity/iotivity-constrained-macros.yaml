---
# IoTivity Constrained Macros

## Wrappers
- wrapper:
    name: build-timeout
    wrappers:
      - timeout:
          type: no-activity
          timeout: 90
          abort: true

- wrapper:
    name: build-timeout-fail
    wrappers:
      - timeout:
          type: no-activity
          timeout: 90
          fail: true

## Builders
- builder:
    name: auto-build
    builders:
      - shell: |
            #!/bin/bash -eux
            set -o pipefail

            export VERBOSE=false
            export CCACHE_DISABLE=false
            cd tests
            ./auto_build.sh {component}

- builder:
    name: unit-tests
    builders:
      - shell: |
            #!/bin/bash -eux
            set -o pipefail

            ulimit -c unlimited

            export VERBOSE=true
            export CCACHE_DISABLE=true
            cd tests
            ./auto_build.sh unit_tests

## Publishers
- publisher:
    name: archive-artifacts
    publishers:
      - archive:
          artifacts: '{artifacts}'
          latest-only: false
          allow-empty: true
          only-if-successful: false
          fingerprint: false
          default-excludes: true

- publisher:
    name: email-notification
    publishers:
      - email:
          recipients: '{mailto}'
          notify-every-unstable-build: false
          send-to-individuals: false

- publisher:
    name: email-notification-unstable
    publishers:
      - email:
          recipients: '{mailto}'
          notify-every-unstable-build: true
          send-to-individuals: true

- publisher:
    name: retry-build-on-builder-error
    publishers:
      - naginator:
          regular-expression: "ERROR: Connection was broken: java.io.EOFException"
          max-failed-builds: 2

- publisher:
    name: wipe-workspace
    publishers:
        - workspace-cleanup:
            fail-build: false
